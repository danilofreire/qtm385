---
title: QTM 385 - Experimental Methods
subtitle: Lecture 15 - Natural and Quasi-Experiments
author:
  - name: Danilo Freire
    email: danilo.freire@emory.edu
    affiliations: Emory University
format:
  clean-revealjs:
    self-contained: true
    code-overflow: wrap
    footer: "[Quasi-Experiments](https://raw.githack.com/danilofreire/qtm385/main/lectures/lecture-15/15-quasi.html)"
transition: slide
transition-speed: default
scrollable: true
engine: knitr
revealjs-plugins:
  - multimodal
editor:
  render-on-save: true
---

# Hello, everyone! üòä {background-color="#2d4563"}

# Brief recap üìö {background-color="#2d4563"}

## Pre-analysis plans
### Core Components
:::{style="font-size: 24px; margin-top: 30px;"}
:::{.columns}
:::{.column width="50%"}
- [7-section structure]{.alert}: Introduction, Hypotheses, Population, Intervention, Outcomes, Analysis, Implementation (EGAP template)
- [Key historical roots]{.alert}: FDA Modernization Act 1997, reproducibility crisis
- [Critical elements]{.alert}:
  - Clear [primary/secondary hypotheses]{.alert} with theoretical basis
  - [Power analysis]{.alert} for sample size determination
  - [Ethical safeguards]{.alert} for vulnerable populations
:::

:::{.column width="50%"}
- [PAPs increase transparency]{.alert} and reduce publication bias
- [PAPs can (and should!) be flexible]{.alert}
- Some scholars say [PAPs are overrated]{.alert}, but they are here to stay
- Best practices:
  - Use [OSF/AEA/EGAP registries]{.alert} to host your PAP
  - Include [randomisation code]{.alert} snippets
  - Pre-specify [attrition handling]{.alert} methods
  - You can use [DeclareDesign](https://declaredesign.org/){.alert} to do all that!
  - [Share your PAP]{.alert} with collaborators and reviewers!
:::
:::
:::

## Implementation challenges

:::{style="font-size: 23px; margin-top: 30px;"}
:::{.columns}
:::{.column width="40%"}
- [PAPs are not perfect]{.alert}: 50% of researchers spend more than 2 weeks writing them
- Common pitfalls:
  - [Over-specification]{.alert} of analysis paths
  - [Underpowered designs]{.alert} due to sample constraints
  - [Non-compliance]{.alert} with treatment protocols
- Solutions:
  - [Pre-registered flexibility]{.alert} for exploratory analysis
  - [Sensitivity analyses]{.alert} for robustness checks
  - Clear [attrition management]{.alert} strategies
:::

:::{.column width="60%"}
:::{style="margin-top: -30px; text-align: center;"}
![](figures/pap.png){width=80%}

Source: <https://egap.org/resource/10-things-to-know-about-pre-analysis-plans/>
:::
:::
:::
:::

# Today's plan üìÖ {background-color="#2d4563"}

## When experiments are not possible

:::{style="font-size: 20px; margin-top: 30px;"}
:::{.columns}
:::{.column width="50%"}
- The [experimental ideal]{.alert} is not always feasible
  - [Ethical constraints]{.alert}, [logistical challenges]{.alert}, [political barriers]{.alert}
- [Natural experiments]{.alert}: When "nature" (broadly speaking) does the randomisation
  - [Examples]{.alert}: Earthquakes, hurricanes, pandemics
  - [More examples]{.alert}: Political transitions, policy changes, civil wars
- [Quasi-experiments]{.alert}: Broader term than natural experiments, sometimes we can control the treatment but not the assignment
  - [Examples]{.alert}: School vouchers, minimum wage laws, health interventions
  - [Methods to estimate causal effects]{.alert}: Difference-in-differences, regression discontinuity, instrumental variables
- They are [somewhere between observational and experimental studies]{.alert}, and have received increased attention in the last decades
:::

:::{.column width="50%"}
:::{style="text-align: center;"}
![](figures/natural.jpg){width=50%}

Source: <https://doi.org/10.1017/CBO9781139084444>
:::
:::
:::
:::

# The experimental ideal and its limits üåü {background-color="#2d4563"}

## Why we should think about observational studies with RCTs in mind

:::{style="font-size: 21px; margin-top: 30px;"}
:::{.columns}
:::{.column width="50%"}
- As you already know by now, RCTs have the highest internal validity among all research designs
- Since the treatment is isolated from other factors, we can be more confident about the causal effect
- But RCTs are not always feasible, and sometimes they are not ethical or practical
  - [Example]{.alert}: Testing the effects of smoking on health outcomes, or of poverty on child development
- In these cases, we need to think creatively about how to estimate causal effects
- Yet, [the logic of RCTs should guide our thinking]{.alert} in observational studies
  - [Random assignment]{.alert}, [control groups]{.alert}, [pre-treatment equivalence]{.alert}, [selection bias]{.alert}
:::

:::{.column width="50%"}
- [Natural and quasi-experiments]{.alert} are attempts to [approximate the conditions of an RCT when true randomisation is not possible]{.alert}
- They are ["second-best" in terms of internal validity]{.alert} compared to a well-executed RCT
- But often the best available or only feasible options
- [Both RCTs and natural/quasi-experiments are driven by the same goal]{.alert}: to establish causal relationships
- The core logic of experiments, that is, [of counterfactuals and potential outcomes]{.alert}, is the same
- Natural and quasi-experiments often have [higher external validity]{.alert} than RCTs, as they are closer to real-world conditions
- But we only use [observational data]{.alert} 
:::
:::
:::

# Natural experiments üåç {background-color="#2d4563"}

## Definition

:::{style="font-size: 25px; margin-top: 30px;"}
- [Natural experiments]{.alert} are situations where the assignment of treatment is determined by nature or other factors outside the control of the researcher
- They are [quasi-experimental]{.alert} designs that mimic the random assignment of treatments in experimental studies
- In many ways, they are the "[gold standard]{.alert}" (so to speak!) for causal inference in observational studies
- There are mainly [two kinds of natural experiments]{.alert}:
  - [True natural experiments]{.alert}: When the treatment is [indeed randomly assigned]{.alert}
  - [As-if natural experiments]{.alert}: When the treatment is [assigned by a procedure]{.alert} that we claim is as good as random for practical purposes
  - [Examples of true natural experiments]{.alert}: Natural disasters, weather changes, lottery wins
  - [Examples of as-if natural experiments]{.alert}: Eligibility rules, policy changes, roll-out of new technologies
:::

## True natural experiments

:::{style="font-size: 27px; margin-top: 30px;"}
- [True natural experiments]{.alert} are rare but great opportunities for causal inference
- They can be analysed in [the same way as RCTs]{.alert}, with [treatment and control groups]{.alert} and [pre-treatment equivalence]{.alert}
- The same concerns about [internal validity]{.alert} apply to true natural experiments
  - [Attrition]{.alert}
  - [Non-compliance]{.alert} 
  - [Contamination]{.alert}
- However, the researcher needs to make [stronger assumptions]{.alert} about the assignment mechanism in true natural experiments 
- Yet often it is indeed the case that the assignment is random
:::

## Example 01: Charter schools

:::{style="font-size: 21px; margin-top: 30px; text-align: center;"}
![](figures/lottery.webp){width=70%}
:::

## Angrist et al. (2013)
### Explaining charter school effectiveness

:::{style="font-size: 21px; margin-top: 30px; text-align: center;"}
![](figures/angrist.png){width=70%}

Source: <https://www.aeaweb.org/articles?id=10.1257/app.5.4.1>
:::

## Research question and challenge

:::{style="margin-top: 30px; font-size: 26px;"}
:::{.columns}
:::{.column width="50%"}
- [Research question]{.alert}: What is the *causal effect* of attending charter schools in Massachusetts on student test scores?
- [The challenge]{.alert}: Students who choose to attend charter schools are likely different from those who don't
    -  Maybe more motivated families, different prior academic preparation, etc
    -  This is [selection bias]{.alert}! 
-  Need a way to isolate the causal effect of charter schools, not just correlation
:::

:::{.column width="50%"}
- [The clever idea]{.alert}:  Many charter schools are oversubscribed and use lotteries to decide who gets in
- [Instrumental Variable (IV) Approach]{.alert}:  Use lottery win as an instrument to estimate the causal effect of charter attendance.
    -  Lottery win $\rightarrow$ Charter Attendance $\rightarrow$ Test Scores
    -  Lottery win is related to charter attendance, but ideally *only* affects test scores through charter attendance.
:::
:::
:::

## Estimation strategy

:::{style="margin-top: 30px; font-size: 22px;"}
:::{.columns}
:::{.column width="50%"}
- [Equation (1)]{.alert}: Outcome equation (What we want to explain)

$Y_{igt} = \alpha_{2t} + \beta_{2g} + \sum_{j} \delta_{j} d_{ij} + X_{i}' \theta + \tau S_{igt} + \epsilon_{igt}$

-  $Y_{igt}$: Test score for student *i*, grade *g*, year *t*
-  $S_{igt}$: Years spent in charter school (our treatment)
-  $\tau$:  [Causal effect of charter attendance]{.alert} (what we want to find!)
-  Lots of control variables ($X_i$, year and grade fixed effects, etc) to account for other factors
:::

:::{.column width="50%"}
- [Equation (2)]{.alert}: First Stage (How lottery affects attendance)

$S_{igt} = \alpha_{1t} + \beta_{1g} + \sum_{j} \kappa_{ij} d_{ij} + X_{i}' \mu + \pi Z_{i} + \eta_{igt}$

-  $Z_i$:  Dummy variable = 1 if student *i* won the charter lottery (our instrument)
-  $\pi$:  Effect of lottery win on charter attendance (should be positive and strong)

- [In Plain English]{.alert}:

1. **First Stage:** Check if winning the lottery actually increases charter school attendance (it should!)
2. **Second Stage:** Use the *lottery win* (which is random) to predict charter school attendance, and then see how this *predicted* attendance affects test scores
:::
:::
:::

## Results

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
![](figures/angrist-results01.png){width=70%}
:::

## Results

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
![](figures/angrist-results02.png){width=80%}
:::

##  "As-If" randomness: The core assumption of natural experiments

:::{style="margin-top: 30px; font-size: 25px;"}
- The validity of natural experiments hinges on the assumption of ["as-if" randomness]{.alert}
- We need to argue for the [plausibility that the natural assignment mechanism is exogenous]{.alert}
    - Independent of other factors that influence the outcome
- Consider:
    - Is the "natural" assignment process truly [independent of confounding variables]{.alert}?
    - Could individuals or groups have [influenced the "assignment"]{.alert} to treatment or control?
    - Is there evidence of [pre-existing differences]{.alert} between the groups "naturally" assigned to different conditions?
- Requires careful [justification and scrutiny]{.alert} of the assignment process
- Not always perfect randomness, but [sufficient approximation for causal inference]{.alert} in many cases
:::

## Example 02: Ferwerda and Miller (2014)
### Political Devolution and Resistance to Foreign Rule: A Natural Experiment

:::{style="font-size: 21px; margin-top: 30px; text-align: center;"}
![](figures/ferwerda.png){width=80%}

Source: [Ferwerda, J., & Miller, M. A. (2014). Political devolution and resistance to foreign rule: A natural experiment. *American Political Science Review*, 108(3), 642‚Äì660. doi:10.1017/S0003055414000240](https://doi.org/10.1017/S0003055414000240)
:::

## Theory and "as-if" randomness

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
:::{.columns}
:::{.column width="50%"}
![](figures/ferwerda-theory.png){width=100%}
:::

:::{.column width="50%"}
![](figures/ferwerda-randomness.png){width=100%}
:::
:::
:::

## Results

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
![](figures/ferwerda-results.png){width=80%}
:::

## Criticism of the natural experiment approach
### Kocher and Monteiro (2016)

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
![](figures/kocher01.png){width=80%}

Source: <https://doi.org/10.1017/S1537592716002863>
:::

## Kocher and Monteiro (2016)

:::{style="font-size: 24px; margin-top: 30px; text-align: center;"}
:::{.columns}
:::{.column width="50%"}
![](figures/kocher02.png){width=80%}
:::

:::{.column width="50%"}
![](figures/kocher03.png){width=80%}
:::
:::
:::

# Quasi-experiments üìä {background-color="#2d4563"}

## Quasi-experiments: A broader toolkit for approximation

:::{style="margin-top: 30px; font-size: 26px;"}
- Quasi-experiments encompass a [wider range of designs]{.alert} that lack full random assignment by the researcher
- Often involve some researcher manipulation of the research design, but not direct treatment randomisation
- Includes natural experiments as a subset, but also encompasses designs where researchers [actively construct comparison groups]{.alert}
- Key feature: [strategic use of design and statistical techniques]{.alert} to address confounding and selection bias
- Examples of Quasi-Experimental Designs:
    - [Regression Discontinuity Design (RDD)]{.alert}
    - [Difference-in-Differences (DID)]{.alert}
    - [Instrumental Variables (IV)]{.alert}
    - [Matching Methods]{.alert}
:::

## Regression Discontinuity Design (RDD)

:::{style="margin-top: 30px; font-size: 26px;"}
- RDD exploits sharp discontinuities in treatment assignment based on a [threshold or cutoff score]{.alert}
- Units are assigned to treatment or control based on whether they fall above or below a specific cutoff point on a [continuous assignment variable (running variable)]{.alert}
- Compares units [just above the threshold to units just below]{.alert}
  - Formally, 
- Logic: Units very close to the cutoff are likely to be [very similar in all other respects]{.alert}, except for treatment status
- Cutoff creates a [local "as-if" randomisation]{.alert} around the threshold
- RDD estimates the [treatment effect at the discontinuity point]{.alert}
- Key Assumption: [Continuity]{.alert}
    - Potential outcomes are continuous functions of the assignment variable at the cutoff
    - No other discontinuous changes at the cutoff point besides the treatment
:::

## RDD: Visualising the discontinuity

:::{style="margin-top: 30px; font-size: 21px;"}
:::{.columns}
:::{.column width="60%"}
:::{style="text-align: center;"}
![](figures/rdd.gif){width=80%}

Source: [Nick Huntington-Klein](https://www.nickchk.com/causalgraphs.html)
:::
:::

:::{.column width="40%"}
- [X-axis]{.alert}: Assignment/running variable 
- [Y-axis]{.alert}: Outcome variable
- [Vertical dashed line]{.alert}: Cutoff threshold
- Treatment assigned for [D >= Cutoff]{.alert}
- [Continuity assumption]{.alert}: Smooth relationship between X and Y, except for the treatment effect at the cutoff
- [Fuzzy RDD]{.alert}: When treatment assignment is not perfectly determined by the cutoff (some non-compliance)
- [Manipulation]{.alert} of assignment variable can invalidate RDD
- [Local Average Treatment Effect (LATE)]{.alert}: RDD estimates effect for those near the cutoff
- Extrapolation beyond the cutoff is [generally not recommended]{.alert}
:::
:::
:::



# Thanks very much! üòä {background-color="#2d4563"}

# See you next time! üëã {background-color="#2d4563"}