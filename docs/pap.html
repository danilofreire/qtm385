<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A Guide to Pre-Analysis Plans (PAPs) – QTM 385</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2b3e328b71be8d25427581baeb23079b.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d904793c2fe8b9f05fdc73cba6253167.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-508422c006262752e20ae841d8f41dd3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-d904793c2fe8b9f05fdc73cba6253167.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">QTM 385</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lectures.html"> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./guides.html"> 
<span class="menu-text">Guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://danilofreire.github.io/qtm385/jupyter"> 
<span class="menu-text">Jupyter Lite</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./LICENSE.html"> 
<span class="menu-text"> </span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/danilofreire/qtm385" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose-and-benefits-of-paps" id="toc-purpose-and-benefits-of-paps" class="nav-link active" data-scroll-target="#purpose-and-benefits-of-paps">Purpose and Benefits of PAPs</a>
  <ul class="collapse">
  <li><a href="#enhancing-research-transparency" id="toc-enhancing-research-transparency" class="nav-link" data-scroll-target="#enhancing-research-transparency">Enhancing Research Transparency</a></li>
  <li><a href="#improving-research-quality" id="toc-improving-research-quality" class="nav-link" data-scroll-target="#improving-research-quality">Improving Research Quality</a></li>
  <li><a href="#addressing-publication-bias" id="toc-addressing-publication-bias" class="nav-link" data-scroll-target="#addressing-publication-bias">Addressing Publication Bias</a></li>
  <li><a href="#increasing-credibility" id="toc-increasing-credibility" class="nav-link" data-scroll-target="#increasing-credibility">Increasing Credibility</a></li>
  <li><a href="#facilitating-replication" id="toc-facilitating-replication" class="nav-link" data-scroll-target="#facilitating-replication">Facilitating Replication</a></li>
  </ul></li>
  <li><a href="#key-components-of-a-pap" id="toc-key-components-of-a-pap" class="nav-link" data-scroll-target="#key-components-of-a-pap">Key Components of a PAP</a>
  <ul class="collapse">
  <li><a href="#research-questions-and-hypotheses" id="toc-research-questions-and-hypotheses" class="nav-link" data-scroll-target="#research-questions-and-hypotheses">Research Questions and Hypotheses</a></li>
  <li><a href="#sample-and-data-collection" id="toc-sample-and-data-collection" class="nav-link" data-scroll-target="#sample-and-data-collection">Sample and Data Collection</a></li>
  <li><a href="#outcome-measures" id="toc-outcome-measures" class="nav-link" data-scroll-target="#outcome-measures">Outcome Measures</a></li>
  <li><a href="#statistical-models-and-analyses" id="toc-statistical-models-and-analyses" class="nav-link" data-scroll-target="#statistical-models-and-analyses">Statistical Models and Analyses</a></li>
  <li><a href="#multiple-hypothesis-testing" id="toc-multiple-hypothesis-testing" class="nav-link" data-scroll-target="#multiple-hypothesis-testing">Multiple Hypothesis Testing</a></li>
  <li><a href="#covariates-and-control-variables" id="toc-covariates-and-control-variables" class="nav-link" data-scroll-target="#covariates-and-control-variables">Covariates and Control Variables</a></li>
  <li><a href="#heterogeneous-effects" id="toc-heterogeneous-effects" class="nav-link" data-scroll-target="#heterogeneous-effects">Heterogeneous Effects</a></li>
  <li><a href="#power-calculations" id="toc-power-calculations" class="nav-link" data-scroll-target="#power-calculations">Power Calculations</a></li>
  </ul></li>
  <li><a href="#when-to-use-paps" id="toc-when-to-use-paps" class="nav-link" data-scroll-target="#when-to-use-paps">When to Use PAPs</a></li>
  <li><a href="#challenges-and-limitations" id="toc-challenges-and-limitations" class="nav-link" data-scroll-target="#challenges-and-limitations">Challenges and Limitations</a>
  <ul class="collapse">
  <li><a href="#constraining-exploratory-analysis" id="toc-constraining-exploratory-analysis" class="nav-link" data-scroll-target="#constraining-exploratory-analysis">Constraining Exploratory Analysis</a></li>
  <li><a href="#incomplete-specification" id="toc-incomplete-specification" class="nav-link" data-scroll-target="#incomplete-specification">Incomplete Specification</a></li>
  <li><a href="#time-and-resource-intensive" id="toc-time-and-resource-intensive" class="nav-link" data-scroll-target="#time-and-resource-intensive">Time and Resource Intensive</a></li>
  <li><a href="#balancing-specificity-and-flexibility" id="toc-balancing-specificity-and-flexibility" class="nav-link" data-scroll-target="#balancing-specificity-and-flexibility">Balancing Specificity and Flexibility</a></li>
  </ul></li>
  <li><a href="#best-practices-for-creating-paps" id="toc-best-practices-for-creating-paps" class="nav-link" data-scroll-target="#best-practices-for-creating-paps">Best Practices for Creating PAPs</a>
  <ul class="collapse">
  <li><a href="#be-specific-but-allow-for-flexibility" id="toc-be-specific-but-allow-for-flexibility" class="nav-link" data-scroll-target="#be-specific-but-allow-for-flexibility">Be Specific but Allow for Flexibility</a></li>
  <li><a href="#register-your-pap" id="toc-register-your-pap" class="nav-link" data-scroll-target="#register-your-pap">Register Your PAP</a></li>
  <li><a href="#update-as-necessary" id="toc-update-as-necessary" class="nav-link" data-scroll-target="#update-as-necessary">Update as Necessary</a></li>
  <li><a href="#use-clear-and-precise-language" id="toc-use-clear-and-precise-language" class="nav-link" data-scroll-target="#use-clear-and-precise-language">Use Clear and Precise Language</a></li>
  <li><a href="#include-code-and-syntax" id="toc-include-code-and-syntax" class="nav-link" data-scroll-target="#include-code-and-syntax">Include Code and Syntax</a></li>
  <li><a href="#seek-feedback" id="toc-seek-feedback" class="nav-link" data-scroll-target="#seek-feedback">Seek Feedback</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/danilofreire/qtm385/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/danilofreire/qtm385/blob/gh-pages/pap.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Guide to Pre-Analysis Plans (PAPs)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Pre-Analysis Plans (PAPs) are detailed documents that researchers create before collecting or analysing data, outlining their intended research methodology, hypotheses, and analytical approach. These plans have become increasingly important in social and biological sciences as a tool to enhance research transparency, credibility, and reproducibility. PAPs serve as a roadmap for researchers, helping them think through their study design and analysis strategy in advance, while also providing a public record of their intentions.</p>
<p>The use of PAPs has grown significantly in recent years, particularly in fields such as economics, political science, and psychology. According to the American Economic Association’s website, as of 2024, the <a href="https://www.socialscienceregistry.org/">AEA RCT Registry</a> currently lists about 10,000 studies with locations in 169 countries. This trend reflects a growing recognition of the importance of research transparency and the need to address issues such as publication bias and p-hacking.</p>
<section id="purpose-and-benefits-of-paps" class="level1">
<h1>Purpose and Benefits of PAPs</h1>
<section id="enhancing-research-transparency" class="level2">
<h2 class="anchored" data-anchor-id="enhancing-research-transparency">Enhancing Research Transparency</h2>
<p>PAPs provide a clear record of the researcher’s intentions before data collection or analysis, reducing concerns about data mining or selective reporting. By specifying analyses in advance, researchers demonstrate their commitment to transparent and unbiased research practices. This transparency allows other researchers and stakeholders to distinguish between pre-planned analyses and exploratory findings, increasing confidence in the reported results.</p>
<p>For example, in a study on the effects of a cash transfer program on educational outcomes, researchers might specify in their PAP that they will analyse the impact on primary school enrollment rates, test scores, and dropout rates. By doing so, they commit to reporting these outcomes regardless of whether the results are statistically significant or align with their hypotheses. This approach prevents the temptation to selectively report only positive or interesting findings after seeing the data.</p>
</section>
<section id="improving-research-quality" class="level2">
<h2 class="anchored" data-anchor-id="improving-research-quality">Improving Research Quality</h2>
<p>By forcing researchers to think through their analysis in advance, PAPs can lead to better-designed studies and more robust analytical approaches. This process often reveals potential issues or oversights that can be addressed before data collection begins. For instance, when drafting a PAP, researchers might realise they need to include additional control variables or consider potential confounding factors they had not initially thought of.</p>
<p>Consider a medical study examining the effectiveness of a new drug. In developing the PAP, researchers might recognise the need to stratify their sample based on age groups or pre-existing conditions, leading to a more nuanced and informative analysis. They might also identify potential interaction effects between the drug and other medications, prompting them to collect data on participants’ full medical histories.</p>
</section>
<section id="addressing-publication-bias" class="level2">
<h2 class="anchored" data-anchor-id="addressing-publication-bias">Addressing Publication Bias</h2>
<p>PAPs can help combat publication bias by encouraging the reporting of all pre-specified analyses, regardless of their results. This approach ensures that null or unexpected findings are not selectively omitted from publication. Publication bias is a significant issue in many fields, where studies with positive or novel results are more likely to be published than those with null or negative findings.</p>
<p>For example, in psychology, the “file drawer problem” refers to the tendency for studies with non-significant results to remain unpublished. By pre-registering their analyses, researchers commit to reporting all findings, which can help provide a more balanced view of the evidence. In a meta-analysis of psychological interventions, for instance, including pre-registered studies might reveal that the overall effect size is smaller than what would be estimated based solely on published literature.</p>
</section>
<section id="increasing-credibility" class="level2">
<h2 class="anchored" data-anchor-id="increasing-credibility">Increasing Credibility</h2>
<p>Pre-registering analyses can increase the credibility of research findings, as it demonstrates that the results were not cherry-picked or manipulated to achieve desired outcomes. This is particularly important in fields where research findings can influence policy decisions or clinical practices.</p>
<p>For instance, in a study on the effectiveness of a new educational intervention, pre-registering the primary outcome measures (e.g., standardised test scores) and analysis methods prevents researchers from selectively reporting only the most favorable results. If the intervention shows mixed effects – perhaps improving math scores but not reading scores – the PAP ensures that both outcomes are reported, providing a more accurate picture of the intervention’s impact.</p>
</section>
<section id="facilitating-replication" class="level2">
<h2 class="anchored" data-anchor-id="facilitating-replication">Facilitating Replication</h2>
<p>Detailed PAPs make it easier for other researchers to replicate studies, as they provide a clear roadmap of the intended analyses and methodologies. Replication is crucial for scientific progress, but it often fails due to insufficient information about the original study’s methods.</p>
<p>For example, in a complex econometric analysis of labor market policies, a well-written PAP would specify not only the data sources and variables used but also the exact statistical models, including any transformations or coding of variables. This level of detail allows other researchers to reproduce the analysis, even if they do not have access to the original data, by following the same procedures with similar datasets.</p>
</section>
</section>
<section id="key-components-of-a-pap" class="level1">
<h1>Key Components of a PAP</h1>
<section id="research-questions-and-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="research-questions-and-hypotheses">Research Questions and Hypotheses</h2>
<p>Clearly state the primary research questions and hypotheses to be tested. Be specific about what you expect to find and why. This section should provide a theoretical framework for the study and explain how the hypotheses relate to existing literature. For instance:</p>
<p><strong>Research Question</strong>: “<em>Does providing microfinance loans to women in rural areas increase their household income and empowerment?</em>”</p>
<p><strong>Hypotheses</strong>:</p>
<ol type="1">
<li>Women who receive microfinance loans will show a 20% increase in household income after one year compared to the control group.</li>
<li>Loan recipients will report higher scores on a standardised empowerment index, with an expected effect size of 0.5 standard deviations.</li>
<li>The impact of loans on income will be moderated by the recipient’s level of education, with more educated women showing larger income gains.</li>
</ol>
</section>
<section id="sample-and-data-collection" class="level2">
<h2 class="anchored" data-anchor-id="sample-and-data-collection">Sample and Data Collection</h2>
<p>Describe the sample size, sampling method, and data collection procedures in detail. Include information on:</p>
<ul>
<li>Target population</li>
<li>Inclusion and exclusion criteria</li>
<li>Recruitment methods</li>
<li>Sample size calculations and power analysis</li>
</ul>
<p>For instance, in a study on the effectiveness of a new teaching method:</p>
<p>“We will recruit 1000 students from 50 public high schools in urban areas of California. Schools will be randomly selected from a list of all eligible schools (defined as those with at least 500 students and a 30% or higher free lunch program participation rate). Within each school, we will randomly select 20 students from the 10th grade. Power calculations indicate that this sample size will allow us to detect an effect size of 0.2 standard deviations with 80% power at a 5% significance level, accounting for potential clustering at the school level.”</p>
</section>
<section id="outcome-measures" class="level2">
<h2 class="anchored" data-anchor-id="outcome-measures">Outcome Measures</h2>
<p>Define primary and secondary outcome measures, including how they will be constructed from raw data. Provide detailed information on:</p>
<ul>
<li>Variable definitions</li>
<li>Measurement scales</li>
<li>Data sources</li>
<li>Any planned data transformations</li>
</ul>
<p>Example for a health intervention study: “Primary outcome: Body Mass Index (BMI), calculated as weight in kilograms divided by height in meters squared. Weight will be measured using a calibrated digital scale, and height will be measured using a stadiometer. Both measurements will be taken twice and averaged.</p>
<p>Secondary outcomes:</p>
<ol type="1">
<li>Physical activity level: Measured using the International Physical Activity Questionnaire (IPAQ), scored according to the official IPAQ scoring protocol.</li>
<li>Dietary quality: Assessed using a 7-day food diary, which will be analysed to create a Healthy Eating Index (HEI) score ranging from 0-100.</li>
<li>Self-efficacy for health behaviors: Measured using the Health-Specific Self-Efficacy Scale, a 10-item Likert scale questionnaire.”</li>
</ol>
</section>
<section id="statistical-models-and-analyses" class="level2">
<h2 class="anchored" data-anchor-id="statistical-models-and-analyses">Statistical Models and Analyses</h2>
<p>Specify the statistical models and analyses to be used, including:</p>
<ul>
<li>Type of statistical tests (e.g., t-tests, ANOVA, regression)</li>
<li>Model specifications</li>
<li>Handling of missing data</li>
<li>Treatment of outliers</li>
<li>Planned subgroup analyses or robustness checks</li>
</ul>
<p>For example, in an economic study on the impact of a job training program:</p>
<p>“Main analysis: We will use an OLS regression model to estimate the effect of the job training program on annual income:</p>
<p><span class="math display">\[ Income_i = \beta_0 + \beta_1 Treatment_i + \beta_2 BaselineIncome_i + \beta_3 Education_i + \beta_4 Age_i + \beta_5 Gender_i + \varepsilon_i \]</span></p>
<p>Where <span class="math inline">\(Treatment_i\)</span> is a dummy variable indicating assignment to the job training program.</p>
<p>Missing data: We will use multiple imputation with chained equations (MICE) to handle missing data, creating 20 imputed datasets.</p>
<p>Outliers: Income values above the 99th percentile will be winsorised to reduce the influence of extreme outliers.</p>
<p>Subgroup analysis: We will examine heterogeneous treatment effects by gender and by baseline income quartiles, adding interaction terms to the main regression model.</p>
<p>Robustness checks: We will re-run the main analysis using a difference-in-differences approach and a propensity score matching method to ensure our results are not sensitive to the choice of analytical approach.”</p>
</section>
<section id="multiple-hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="multiple-hypothesis-testing">Multiple Hypothesis Testing</h2>
<p>Address how multiple hypothesis testing will be handled to control for false positives. Describe methods such as:</p>
<ul>
<li>Bonferroni correction</li>
<li>False Discovery Rate (FDR) control</li>
<li>Family-wise error rate (FWER) control</li>
</ul>
<p>Example: “To address multiple hypothesis testing, we will use the following approach:</p>
<ol type="1">
<li>For our three primary outcomes, we will use the Bonferroni correction, adjusting the significance level to <span class="math inline">\(\alpha = 0.05 / 3 = 0.0167\)</span>.</li>
<li>For secondary outcomes, we will control the False Discovery Rate using the Benjamini-Hochberg procedure with a q-value of 0.10.</li>
<li>For exploratory analyses, we will report unadjusted p-values but clearly label these findings as exploratory and interpret them cautiously.”</li>
</ol>
</section>
<section id="covariates-and-control-variables" class="level2">
<h2 class="anchored" data-anchor-id="covariates-and-control-variables">Covariates and Control Variables</h2>
<p>List all covariates and control variables to be included in the analyses, explaining their relevance to the research questions. For instance:</p>
<p>“We will include the following control variables in our main regression analyses:</p>
<ol type="1">
<li>Age: Continuous variable, measured in years</li>
<li>Gender: Binary variable (0 = male, 1 = female)</li>
<li>Education level: Categorical variable with four levels (less than high school, high school graduate, some college, college graduate or higher)</li>
<li>Baseline income: Continuous variable, measured in dollars</li>
<li>Employment status at baseline: Binary variable (0 = unemployed, 1 = employed)</li>
</ol>
<p>These variables are included because previous research has shown they are strong predictors of labor market outcomes and may influence the effectiveness of job training programs.”</p>
</section>
<section id="heterogeneous-effects" class="level2">
<h2 class="anchored" data-anchor-id="heterogeneous-effects">Heterogeneous Effects</h2>
<p>If applicable, describe any planned analyses of heterogeneous effects or subgroup analyses. For example:</p>
<p>“We will examine heterogeneous treatment effects for the following subgroups:</p>
<ol type="1">
<li>Gender: We hypothesise that the job training program may have differential effects for men and women due to differences in labor market discrimination and occupational segregation.</li>
<li>Age groups: We will analyse treatment effects separately for participants under 30, 30-50, and over 50 years old, as the effectiveness of job training may vary across career stages.</li>
<li>Education level: We will examine whether the program’s impact differs based on participants’ educational attainment.</li>
</ol>
<p>For each subgroup analysis, we will add interaction terms between the treatment indicator and the subgroup variable to our main regression model.”</p>
</section>
<section id="power-calculations" class="level2">
<h2 class="anchored" data-anchor-id="power-calculations">Power Calculations</h2>
<p>Include power calculations to justify the chosen sample size and demonstrate the ability to detect meaningful effects. For instance:</p>
<p>“We conducted power calculations using <code>R</code> and the <code>DeclareDesign</code> package. Assuming a two-tailed test with <span class="math inline">\(\alpha = 0.05\)</span> and 80% power, our sample size of 1000 participants (500 per group) allows us to detect a minimum effect size of <span class="math inline">\(d = 0.18\)</span> for our primary outcome of annual income. This effect size is considered small to medium and is in line with previous studies on similar job training interventions. For our subgroup analyses, the minimum detectable effect size increases to <span class="math inline">\(d = 0.28\)</span>, which we consider acceptable for these secondary analyses.”</p>
</section>
</section>
<section id="when-to-use-paps" class="level1">
<h1>When to Use PAPs</h1>
<p>PAPs are particularly valuable in:</p>
<ul>
<li>Experimental studies, including randomised controlled trials</li>
<li>Studies with multiple plausible outcome measures</li>
<li>Research involving subgroup analyses</li>
<li>Projects with potential for researcher degrees of freedom in analysis</li>
<li>Large-scale observational studies</li>
<li>Studies with high-stakes outcomes or policy implications</li>
</ul>
<p>For example, in a large-scale randomised controlled trial evaluating the impact of a new educational curriculum, a PAP would be crucial. The study might have multiple outcome measures (e.g., test scores, attendance rates, student engagement), various subgroups of interest (e.g., by gender, socioeconomic status, prior achievement), and potential for different analytical approaches. A PAP would help ensure that the primary analyses are clearly defined and distinguished from exploratory analyses, reducing the risk of cherry-picking results or p-hacking.</p>
<p>Similarly, in an observational study examining the long-term health effects of a particular dietary pattern, a PAP would be valuable. The researchers could specify in advance which health outcomes they will focus on, how they will control for potential confounding factors, and what methods they will use to address issues like selection bias. This approach would increase the credibility of the findings, especially given the often conflicting results in nutritional epidemiology.</p>
</section>
<section id="challenges-and-limitations" class="level1">
<h1>Challenges and Limitations</h1>
<section id="constraining-exploratory-analysis" class="level2">
<h2 class="anchored" data-anchor-id="constraining-exploratory-analysis">Constraining Exploratory Analysis</h2>
<p>PAPs may limit researchers’ ability to explore unexpected findings in the data. To address this, consider including a section for planned exploratory analyses. For example:</p>
<p>“While our primary analyses will focus on the pre-specified outcomes and methods outlined above, we recognise the potential for unexpected findings. We will include a clearly labeled exploratory analysis section in our final report, where we may investigate:</p>
<ol type="1">
<li>Non-linear relationships between continuous predictors and outcomes</li>
<li>Potential mediating factors in the relationship between the intervention and primary outcomes</li>
<li>Unexpected patterns or clusters in the data identified through data visualization techniques</li>
</ol>
<p>Any findings from these exploratory analyses will be clearly labeled as such and interpreted cautiously, with an emphasis on generating hypotheses for future research rather than drawing definitive conclusions.”</p>
</section>
<section id="incomplete-specification" class="level2">
<h2 class="anchored" data-anchor-id="incomplete-specification">Incomplete Specification</h2>
<p>It is challenging to anticipate all possible analyses or issues that may arise during the research process. Be as comprehensive as possible while allowing for some flexibility. For instance:</p>
<p>“While we have attempted to be as comprehensive as possible in this PAP, we acknowledge that unforeseen circumstances may necessitate deviations from the plan. Any such deviations will be clearly documented and justified in the final report. Potential scenarios that might require flexibility include:</p>
<ol type="1">
<li>Lower than expected recruitment rates, which may necessitate adjustments to the power calculations and potentially the analytical approach</li>
<li>Unexpected data quality issues that may require additional data cleaning or imputation methods</li>
<li>External events (e.g., policy changes, economic shocks) that may impact the interpretation of our results</li>
</ol>
<p>In such cases, we will strive to adhere as closely as possible to the spirit of the original plan while making necessary adjustments to ensure the validity and relevance of our analyses.”</p>
</section>
<section id="time-and-resource-intensive" class="level2">
<h2 class="anchored" data-anchor-id="time-and-resource-intensive">Time and Resource Intensive</h2>
<p>Creating a detailed PAP can be time-consuming and may require additional resources. However, this upfront investment often leads to more efficient and robust research in the long run. Researchers should budget time and resources for developing a comprehensive PAP, potentially including:</p>
<ol type="1">
<li>Literature review to inform hypotheses and analytical approaches</li>
<li>Consultation with statisticians or methodologists to refine the analytical plan</li>
<li>Pilot studies or simulations to inform power calculations and test data collection instruments</li>
<li>Team meetings to discuss and refine the PAP</li>
<li>External review of the PAP by colleagues or experts in the field</li>
</ol>
<p>While this process may seem daunting, it can ultimately save time and resources by identifying potential issues early and providing a clear roadmap for the research project.</p>
</section>
<section id="balancing-specificity-and-flexibility" class="level2">
<h2 class="anchored" data-anchor-id="balancing-specificity-and-flexibility">Balancing Specificity and Flexibility</h2>
<p>Finding the right balance between being specific enough to prevent p-hacking and flexible enough to address unforeseen circumstances can be challenging. One approach is to specify decision rules for potential deviations from the plan. For example:</p>
<p>“We will adhere to the following decision rules for potential deviations from the PAP:</p>
<ol type="1">
<li>If recruitment falls below 80% of the target sample size, we will recalculate power analyses and may adjust our primary outcome to a composite measure to maintain adequate statistical power.</li>
<li>If attrition exceeds 20%, we will conduct sensitivity analyses using multiple imputation and inverse probability weighting in addition to our planned complete case analysis.</li>
<li>If we discover strong violations of model assumptions (e.g., non-normality, heteroscedasticity), we will employ appropriate transformations or alternative modeling approaches (e.g., generalised linear models, non-parametric tests) and report both the original and alternative analyses.”</li>
</ol>
</section>
</section>
<section id="best-practices-for-creating-paps" class="level1">
<h1>Best Practices for Creating PAPs</h1>
<section id="be-specific-but-allow-for-flexibility" class="level2">
<h2 class="anchored" data-anchor-id="be-specific-but-allow-for-flexibility">Be Specific but Allow for Flexibility</h2>
<p>Provide detailed plans while allowing for some flexibility to address unforeseen circumstances. Consider including decision rules for potential deviations from the plan. For example:</p>
<p>“This PAP outlines our primary analytical strategy, but we acknowledge that unforeseen circumstances may necessitate adjustments. We will adhere to the following principles when considering deviations from the plan:</p>
<ol type="1">
<li>Any deviation must be justified based on methodological grounds or unforeseen data characteristics, not on the results of preliminary analyses.</li>
<li>All deviations will be clearly documented and reported in the final manuscript, including the rationale for the change and any implications for the interpretation of results.</li>
<li>We will consult with independent experts or our advisory board before implementing major changes to the analysis plan.</li>
<li>If substantial deviations are required, we will consider publishing an addendum to the original PAP, clearly stating the changes and their justifications.”</li>
</ol>
</section>
<section id="register-your-pap" class="level2">
<h2 class="anchored" data-anchor-id="register-your-pap">Register Your PAP</h2>
<p>Register your PAP with a recognised registry, such as:</p>
<ul>
<li><a href="https://osf.io/registries">Open Science Framework (OSF)</a></li>
<li><a href="https://osf.io/registries/egap/discover">EGAP Pre-Analysis Plan Registry</a></li>
<li><a href="https://www.socialscienceregistry.org/">AEA RCT Registry</a></li>
<li><a href="https://clinicaltrials.gov/">ClinicalTrials.gov</a> (for medical research)</li>
</ul>
<p>Registration provides a time-stamped, publicly accessible version of your plan, enhancing transparency and credibility.</p>
</section>
<section id="update-as-necessary" class="level2">
<h2 class="anchored" data-anchor-id="update-as-necessary">Update as Necessary</h2>
<p>If changes to the plan are required, document and justify these changes transparently. Consider using version control to track modifications. For example:</p>
<p>“Any updates to this PAP will be logged in a change document, which will include:</p>
<ul>
<li>Date of the change</li>
<li>Description of the modification</li>
<li>Rationale for the change</li>
<li>Potential impact on the interpretation of results</li>
</ul>
<p>This change log will be made publicly available alongside the original PAP.”</p>
</section>
<section id="use-clear-and-precise-language" class="level2">
<h2 class="anchored" data-anchor-id="use-clear-and-precise-language">Use Clear and Precise Language</h2>
<p>Write your PAP in clear, unambiguous language to ensure that other researchers can understand and potentially replicate your planned analyses. Avoid jargon where possible, and define technical terms when they are necessary.</p>
</section>
<section id="include-code-and-syntax" class="level2">
<h2 class="anchored" data-anchor-id="include-code-and-syntax">Include Code and Syntax</h2>
<p>When possible, include example code or syntax for planned analyses to further enhance reproducibility. This could be done by:</p>
<ul>
<li>Providing annotated code snippets in an appendix</li>
<li>Linking to a public repository (e.g., GitHub) with full analysis scripts</li>
<li>Including pseudo-code for complex analytical procedures</li>
</ul>
</section>
<section id="seek-feedback" class="level2">
<h2 class="anchored" data-anchor-id="seek-feedback">Seek Feedback</h2>
<p>Share your PAP with colleagues or mentors for feedback before finalising and registering it. Consider:</p>
<ul>
<li>Organising a pre-registration workshop with your research team</li>
<li>Requesting review from methodologists or subject matter experts</li>
<li>Presenting your PAP at a departmental seminar for broader input</li>
</ul>
</section>
</section>
<section id="examples" class="level1">
<h1>Examples</h1>
<p>For examples of well-crafted PAPs, consider reviewing the following resources:</p>
<ul>
<li><a href="https://osf.io/registries">Open Science Framework (OSF)</a></li>
<li><a href="https://osf.io/registries/egap/discover">EGAP Pre-Analysis Plan Registry</a></li>
<li><a href="https://www.socialscienceregistry.org/">AEA RCT Registry</a></li>
<li><a href="https://clinicaltrials.gov/">ClinicalTrials.gov</a></li>
</ul>
<p>Feel free to search for PAPs in your field of interest to see how other researchers have approached pre-registration.</p>
</section>
<section id="acknowledgements" class="level1">
<h1>Acknowledgements</h1>
<p>This guide was based on the following websites:</p>
<ul>
<li><a href="https://egap.org/resource/10-things-to-know-about-pre-analysis-plans/" class="uri">https://egap.org/resource/10-things-to-know-about-pre-analysis-plans/</a></li>
<li><a href="https://www.povertyactionlab.org/resource/pre-analysis-plans" class="uri">https://www.povertyactionlab.org/resource/pre-analysis-plans</a></li>
<li><a href="https://www.bitss.org/resource-tag/pre-analysis-plans" class="uri">https://www.bitss.org/resource-tag/pre-analysis-plans</a></li>
<li><a href="https://blogs.worldbank.org/en/impactevaluations/how-good-are-pre-analysis-plans-practice-and-lessons-writingreviewing-your-next" class="uri">https://blogs.worldbank.org/en/impactevaluations/how-good-are-pre-analysis-plans-practice-and-lessons-writingreviewing-your-next</a>.</li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Danilo Freire. The content of this site is licensed under the <a href="./LICENSE.html">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/danilofreire/qtm385/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/danilofreire/qtm385/blob/gh-pages/pap.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/danilofreire/qtm385">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>